# 運用課題・検討事項一覧

本ドキュメントでは、勤怠管理アプリを実際に運用する際に必要な制限、検証、方針検討が必要な課題をまとめる。

---

## 1. セキュリティ

### 1.1 ロール判定方式
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| 管理者判定 | メールアドレス（admin@example.com）で判定 | 本番環境では不適切。Firestoreまたはカスタムクレームでの管理が必要 | 高 |
| ロール変更 | 機能なし | 管理者がユーザーのロールを変更する機能が必要 | 高 |

### 1.2 Firestoreセキュリティルール
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| attendances読み取り | 認証済みユーザーは全件読み取り可能 | 一般ユーザーは自分のデータのみ読み取り可能にすべき | 高 |
| users読み取り | 認証済みユーザーは全件読み取り可能 | 管理者のみ全件、一般ユーザーは自分のみにすべき | 高 |
| データ削除 | ルールなし | 勤怠データの削除権限を定義する必要あり | 中 |

### 1.3 位置情報の信頼性
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| 位置情報偽装 | 対策なし | GPS偽装アプリ等による不正打刻の可能性 | 中 |
| 検証方法 | なし | IPアドレス、Wi-Fi情報等との突合検証の検討 | 低 |

---

## 2. ユーザー管理

### 2.1 管理機能
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| ユーザー追加 | 自己登録のみ | 管理者によるユーザー招待・追加機能 | 高 |
| ユーザー削除 | 機能なし | 退職者のアカウント無効化・削除機能 | 高 |
| ユーザー一覧 | 機能なし | 管理者向けユーザー一覧・検索機能 | 中 |
| ロール変更 | 機能なし | 管理者がロールを変更する機能 | 高 |

### 2.2 認証関連
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| パスワードリセット | 機能なし | ユーザー自身でのパスワードリセット機能 | 高 |
| パスワードポリシー | Firebase標準（6文字以上） | 要件に応じて強化が必要か検討 | 中 |
| ログイン試行制限 | Firebase標準 | ブルートフォース対策の確認 | 低 |
| セッション管理 | Firebase標準 | セッションタイムアウトの設定確認 | 低 |

---

## 3. ビジネスルール

### 3.1 出退勤ルール
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| 打刻回数 | 1日1回ずつ | 外出・戻り等の複数回打刻が必要か検討 | 中 |
| 打刻修正 | 機能なし | 誤打刻の修正機能（管理者権限） | 高 |
| 打刻削除 | 機能なし | 誤打刻の削除機能（管理者権限） | 高 |
| 打刻代行 | 機能なし | 管理者による代理打刻機能の要否 | 中 |

### 3.2 日付・時間
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| 日付変更 | 0:00で切り替え | 深夜勤務の場合の日付扱いを検討 | 中 |
| タイムゾーン | ブラウザ依存 | サーバー側での統一処理が必要か検討 | 中 |
| 休日・祝日 | 考慮なし | 休日出勤の扱い、祝日マスタの要否 | 低 |

### 3.3 集計・レポート
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| 勤務時間計算 | 機能なし | 出勤〜退勤の勤務時間自動計算 | 中 |
| 月次集計 | 機能なし | 月間勤務時間の集計機能 | 中 |
| CSVエクスポート | 機能なし | 給与システム連携用のデータ出力 | 中 |
| 勤怠レポート | 機能なし | 月次レポートの出力機能 | 低 |

---

## 4. 技術的制約

### 4.1 外部API依存
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| Nominatim API | レート制限 1req/sec | 同時打刻時の制限対策、キャッシュ導入 | 中 |
| Nominatim API | 利用規約 | 商用利用時のポリシー確認、代替API検討 | 高 |
| API障害時 | エラー表示のみ | 住所なしでの打刻許可、リトライ処理 | 中 |

### 4.2 ブラウザ要件
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| 位置情報許可 | 必須 | 許可しないユーザーへの対応方針 | 高 |
| HTTPS | 必須 | 本番環境でのSSL証明書設定 | 高 |
| オフライン | 非対応 | オフライン時の打刻対応の要否 | 低 |

### 4.3 スケーラビリティ
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| ユーザー数 | 制限なし | 想定ユーザー数に応じたFirestore設計確認 | 中 |
| データ量 | 全件取得 | ページネーション、インデックス最適化 | 中 |
| 同時アクセス | 考慮なし | ピーク時（始業・終業時）の負荷対策 | 低 |

---

## 5. 運用・保守

### 5.1 データ管理
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| バックアップ | なし | 定期バックアップの設定 | 高 |
| データ保持期間 | 無期限 | 法定保存期間（3年）を考慮した保持ポリシー | 中 |
| データ削除 | 手動 | 保持期間経過後の自動削除の要否 | 低 |

### 5.2 監視・ログ
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| エラー監視 | console.error | 本番環境でのエラー通知設定 | 高 |
| アクセスログ | Firebase標準 | 監査ログの要否検討 | 中 |
| パフォーマンス | なし | Firebase Performance Monitoringの導入 | 低 |

### 5.3 障害対応
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| Firebase障害 | 対策なし | 障害時の代替手段（紙運用等） | 中 |
| リストア手順 | なし | バックアップからの復旧手順策定 | 中 |

---

## 6. 法的・コンプライアンス

### 6.1 個人情報保護
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| 位置情報 | 保存 | プライバシーポリシーの策定・同意取得 | 高 |
| 利用目的 | 明示なし | 位置情報の利用目的明示 | 高 |
| データ開示 | 機能なし | 本人からの開示請求への対応方針 | 中 |

### 6.2 労働関連法規
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| 勤怠記録保存 | Firestoreに保存 | 労働基準法に基づく3年間保存の担保 | 高 |
| 残業管理 | 機能なし | 36協定対応のアラート機能の要否 | 中 |
| 有給管理 | 対象外 | 有給休暇管理との連携の要否 | 低 |

---

## 7. UI/UX改善

### 7.1 ユーザビリティ
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| モバイル対応 | レスポンシブ | スマートフォン専用UIの検討 | 中 |
| PWA対応 | なし | ホーム画面追加、プッシュ通知 | 低 |
| 多言語対応 | 日本語のみ | 多言語対応の要否 | 低 |

### 7.2 通知機能
| 項目 | 現状 | 課題 | 優先度 |
|------|------|------|--------|
| 打刻忘れ通知 | なし | 未打刻時のリマインダー通知 | 中 |
| 管理者通知 | なし | 異常打刻時の管理者アラート | 低 |

---

## 優先度凡例

| 優先度 | 説明 |
|--------|------|
| 高 | 本番運用前に対応必須 |
| 中 | 本番運用開始後、早期に対応が望ましい |
| 低 | 将来的に検討 |

---

## 次のステップ

1. **優先度「高」の課題について方針決定**
   - セキュリティルールの強化
   - ロール管理方式の決定
   - パスワードリセット機能の実装
   - 位置情報利用のプライバシーポリシー策定

2. **運用開始前チェックリストの作成**

3. **各課題の詳細設計・実装計画の策定**
