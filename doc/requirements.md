# 勤怠管理アプリ 要件定義書

## 1. システム概要

### 1.1 システム名
勤怠管理アプリ（Kintai App）

### 1.2 目的
従業員の出退勤を位置情報付きで記録し、管理者がリアルタイムで勤務状況を確認できるWebアプリケーション。

### 1.3 対象ユーザー
- 一般ユーザー（従業員）
- 管理者

---

## 2. 機能要件

### 2.1 認証機能

| ID | 機能名 | 説明 |
|----|--------|------|
| AUTH-01 | ログイン | メールアドレスとパスワードによるログイン |
| AUTH-02 | ログアウト | セッション終了 |
| AUTH-03 | 新規登録 | メールアドレス、パスワード、表示名による新規ユーザー登録 |
| AUTH-04 | 開発モード | エミュレータ使用時、プルダウンでテストユーザーを選択可能 |

### 2.2 一般ユーザー機能

| ID | 機能名 | 説明 |
|----|--------|------|
| USER-01 | 出勤打刻 | 位置情報付きで出勤を記録（1日1回のみ） |
| USER-02 | 退勤打刻 | 位置情報付きで退勤を記録（出勤後1回のみ） |
| USER-03 | 本日の記録確認 | 当日の出退勤記録を一覧表示 |

### 2.3 管理者機能

| ID | 機能名 | 説明 |
|----|--------|------|
| ADMIN-01 | 現在の状況確認 | 全従業員の当日の勤務状況をリアルタイム表示 |
| ADMIN-02 | 出退勤履歴確認 | 日付指定で全従業員の出退勤履歴を確認 |

---

## 3. 画面一覧

| 画面ID | 画面名 | パス | 対象ユーザー |
|--------|--------|------|--------------|
| SCR-01 | ログイン画面 | /login | 未認証ユーザー |
| SCR-02 | 新規登録画面 | /register | 未認証ユーザー |
| SCR-03 | 出退勤画面 | /attendance | 一般ユーザー |
| SCR-04 | 管理画面 | /admin | 管理者 |

---

## 4. データ要件

### 4.1 ユーザー情報
| 項目 | 型 | 必須 | 説明 |
|------|-----|------|------|
| uid | string | ○ | ユーザーID（Firebase Auth UID） |
| email | string | ○ | メールアドレス |
| displayName | string | ○ | 表示名 |
| role | string | ○ | ロール（'admin' or 'user'） |
| createdAt | timestamp | ○ | 作成日時 |

### 4.2 勤怠記録
| 項目 | 型 | 必須 | 説明 |
|------|-----|------|------|
| id | string | ○ | レコードID |
| userId | string | ○ | ユーザーID |
| userName | string | ○ | ユーザー表示名 |
| type | string | ○ | 種別（'clock_in' or 'clock_out'） |
| timestamp | timestamp | ○ | 打刻日時 |
| date | string | ○ | 日付（YYYY-MM-DD形式） |
| location.latitude | number | ○ | 緯度 |
| location.longitude | number | ○ | 経度 |
| location.address | string | ○ | 住所 |

---

## 5. 非機能要件

### 5.1 対応環境
- モダンブラウザ（Chrome, Firefox, Safari, Edge最新版）
- レスポンシブデザイン（PC/タブレット/スマートフォン対応）

### 5.2 セキュリティ
- Firebase Authenticationによる認証
- Firestore Security Rulesによるアクセス制御
- HTTPS通信

### 5.3 位置情報
- Geolocation APIによる現在地取得
- OpenStreetMap Nominatimによる逆ジオコーディング（座標→住所変換）

---

## 6. ビジネスルール

### 6.1 出退勤ルール
| ルールID | 内容 |
|----------|------|
| BIZ-01 | 出勤は1日1回のみ打刻可能 |
| BIZ-02 | 退勤は出勤後1回のみ打刻可能 |
| BIZ-03 | 出勤・退勤には位置情報が必須 |

### 6.2 ロール判定
| ルールID | 内容 |
|----------|------|
| BIZ-04 | admin@example.com は管理者ロール |
| BIZ-05 | その他のメールアドレスは一般ユーザーロール |

---

## 7. 開発環境

### 7.1 テストアカウント
| 種別 | メールアドレス | パスワード |
|------|----------------|------------|
| 管理者 | admin@example.com | admin123 |
| 一般ユーザー | user01@example.com | password |

### 7.2 Firebase Emulator
- 開発時はFirebase Emulatorを使用
- 環境変数 `VITE_USE_EMULATORS=true` で切り替え
